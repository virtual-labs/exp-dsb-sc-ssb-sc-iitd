<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Virtual Labs</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- sidebar and body -->
    <div class="flex min-h-[80vh]">
      <div class="px-6 pb-6 flex-1">
        <div class="flex flex-shrink-0">
          <div class="relative w-[700px] py-2">
            <div
              class="absolute bg-[#ffff00] h-[228px] w-2 rounded-md top-[240px] left-[210px]"
            ></div>
            <div
            class="absolute bg-[#ff0000] h-[74px] w-2 rounded-md top-[130px] left-[210px]"
          ></div>
            <div
              class="z-10 absolute bg-[#ffff00] h-2 w-[72px] rounded-md top-[240px] left-[144px]"
            ></div>
            <div
            class="z-10 absolute bg-[#0000ff] h-2 w-[186px] rounded-md top-[252px] left-[384px]"
          ></div>
          <div
          class="z-10 absolute bg-[#0000ff] h-2 flex justify-end w-[84px] rounded-md top-[252px] -right-[8px]"
        ><p class="font-medium pt-1">CH2-B</p>
    </div>
            <div
            class="absolute bg-[#0000ff] h-[338px] w-2 rounded-md top-[252px] left-[252px]"
          ></div>
            <div
            class="z-10 absolute bg-[#0000ff] h-2 w-[72px] rounded-md top-[252px] left-[252px]"
          ></div>
          <div
          class="z-10 absolute bg-[#0000ff] flex justify-end h-2 w-[192px] rounded-md top-[322px] left-[252px]"
        > <p class="font-bold pt-1">CH1-A</p>
    </div>
          <div
          class="z-10 absolute bg-[#0000ff] h-2 w-[72px] rounded-md top-[582px] left-[252px]"
        ></div>
        <div
        class="z-10 absolute bg-[#0000ff] h-2 w-[82px] flex justify-end rounded-md top-[582px] left-[390px]"
      ><p class="font-bold pt-1">CH2-A</p>
    </div>
        <div
        class="z-10 absolute bg-[#0000ff] h-2 w-[102px] rounded-md top-[570px] left-[152px]"
      ></div>

            <div
            class="z-10 absolute bg-[#ff0000] h-2 w-[70px] rounded-md top-[198px] left-[148px]"
          ></div>
            <div
              class="z-10 absolute bg-[#ffff00] h-2 w-[110px] rounded-md top-[460px] left-[210px]"
            ></div>
            <div
              class="z-10 absolute bg-[#ff0000] h-2 w-[110px] rounded-md top-[130px] left-[210px]"
            ></div>
            <div class="flex justify-around p-8 gap-28">
              <!-- audio oscillator -->
              <div
                class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">
                  AUDIO OSCILLATOR
                </h5>
                <div class="flex justify-around py-1">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">SYNC</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">cos(wt)</p>
                  </div>
                </div>
                <div class="flex flex-col items-center">
                  <p class="text-[13px] pb-1 text-center font-semibold">
                    Message Frequency
                  </p>
                  <input
                    id="messageFrequency"
                    value="10"
                    type="range"
                    step="1"
                    min="1"
                    max="2000"
                    onchange="handleMessageFrequencyChange()"
                  />
                  <div class="leading-none messageFrequencyDiv">10</div>
                </div>
                <div class="flex flex-col items-end">
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] border-[5px] border-[#ff0000] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">TTL</p>
                  </div>
                  <div class="flex flex-col items-start">
                    <div
                      class="h-[24px] w-[24px] relative left-2 border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">sin(wt)</p>
                  </div>
                </div>
              </div>
              <!-- Multiplier -->
              <div
              class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">Multiplier</h5>
                <div class="flex flex-col pl-3 pt-[58px] pb-[53px]">
                  <div
                    class="h-[24px] w-[24px] relative border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                  <p>X</p>
                </div>
                <div class="flex absolute bottom-0 w-full justify-around">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">Y</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">KXY</p>
                  </div>
                </div>
              </div>
            <!-- TUNABLE LPF-->
            <div
                class=" mr-2 relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
            >
                <h5 class="text-center text-sm font-medium">TUNABLE LPF</h5>
                <div class="flex mt-6 flex-col items-end">
                <div class="flex flex-col items-start">
                    <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ff0000] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">CLK</p>
                </div>
                </div>
                <div class="flex flex-col items-center justify-center gap-4">
                <div class="flex flex-col items-center">
                    <div
                    class="h-[24px] w-[24px] border-[4px] relative shadow-black shadow-lg border-black bg-[#ffff00] rounded-full"
                    >
                    <div
                        class="w-1 h-2 absolute top-[50%] left-[40%] bg-black"
                    ></div>
                    </div>
                    <p class="text-[12px] font-medium">TUNE</p>
                </div>
                <div class="flex flex-col items-center">
                    <div
                    class="h-[24px] w-[24px] relative border-[4px] shadow-black shadow-md border-black bg-[#ffff00] rounded-full"
                    >
                    <div
                        class="w-1 h-2 absolute top-[50%] left-[40%] bg-black"
                    ></div>
                    </div>
                    <p class="text-[12px] font-medium">GAIN</p>
                </div>
                </div>
                <!--  -->
                <div
                class="flex items-center justify-center gap-8 absolute bottom-0 w-full"
                >
                <div class="flex flex-col items-start">
                    <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">IN</p>
                </div>
                <div class="flex flex-col items-start">
                    <div
                    class="h-[24px] w-[24px] border-[5px] border-[#ffff00] bg-black rounded-full"
                    ></div>
                    <p class="text-[12px] font-medium">OUT</p>
                </div>
                </div>
            </div>
            </div>
            <div class="flex  px-8 mt-12 mb-8 gap-28">
                <!-- master signal -->
                <div
                    class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
                >
                    <h5 class="text-center text-sm font-medium">Master Signals</h5>
                    <div
                    class="absolute top-[90px] flex flex-col items-center gap-y-1"
                    >
                    <p class="text-[13px] pb-1 font-bold">Carrier Frequency:</p>
                    <input
                        id="carrierFrequency"
                        value="1000"
                        type="range"
                        min="1"
                        max="10000"
                        onchange="handleCarrierFrequencyChange()"
                    />
                    <div class="leading-none font-medium carrierFrequencyDiv">
                        1000
                    </div>
                    </div>
                    <div class="flex flex-col gap-4 mt-4 items-end">
                    <div class="flex items-center gap-1">
                        <p class="text-[12px] font-medium">100KHz sin</p>
                        <div
                        class="h-[22px] w-[22px] flex justify-center items-center bg-[#ffff00] rounded-full"
                        >
                        <div
                            class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <p class="text-[12px] font-medium">100KHz cos</p>
                        <div
                        class="h-[22px] w-[22px] flex justify-center items-center bg-[#ffff00] rounded-full"
                        >
                        <div
                            class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <p class="text-[12px] font-medium">100KHz TTL</p>
                        <div
                        class="h-[22px] w-[22px] flex justify-center items-center bg-[#ffff00] rounded-full"
                        >
                        <div
                            class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <p class="text-[12px] font-medium">sample TTL</p>
                        <div
                        class="h-[22px] w-[22px] flex justify-center items-center bg-[#ffff00] rounded-full"
                        >
                        <div
                            class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <p class="text-[12px] font-medium">message sin</p>
                        <div
                        class="h-[22px] w-[22px] flex justify-center items-center bg-[#ffff00] rounded-full"
                        >
                        <div
                            class="h-[14px] w-[14px] bg-[#000] rounded-full"
                        ></div>
                        </div>
                    </div>
                    </div>
                </div>
                <!-- Multiplier -->
              <div
              class="relative bg-[#a9a9a9] p-1 pt-0 border-4 shadow-[5px_5px_5px_5px_rgba(0,0,0,0.6)] border-black w-[140px] h-[250px]"
              >
                <h5 class="text-center text-sm font-medium">Multiplier</h5>
                <div class="flex flex-col pl-3 pt-[58px] pb-[53px]">
                  <div
                    class="h-[24px] w-[24px] relative border-[5px] border-[#ffff00] bg-black rounded-full"
                  ></div>
                  <p>X</p>
                </div>
                <div class="flex absolute bottom-0 w-full justify-around">
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">Y</p>
                  </div>
                  <div class="flex flex-col items-center">
                    <div
                      class="h-[24px] w-[24px] flex justify-center items-center bg-[#ffff00] rounded-full"
                    >
                      <div
                        class="h-[14px] w-[14px] bg-[#000] rounded-full"
                      ></div>
                    </div>
                    <p class="text-[12px] font-medium">KXY</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-col grow-0 items-center">

            <div class="flex  w-full py-4 gap-4">
                <div class="flex flex-1 justify-center gap-1 items-center">
                  <p class="text-nowrap font-medium">Sampling Frequency :</p>
                  <input
                    class="border px-1 w-[142px] py-1 rounded-sm border-black"
                    min="1"
                    type="number"
                    id="samplingFrequency"
                    value="1000"
                    placeholder="sampling frequency in Hz"
                  />
                </div>
                <div class=" flex flex-1  items-center gap-1">
                    <p class="text-nowrap font-medium">Filter Order:</p>
                    <input
                    class="border px-1 w-[142px] py-1 rounded-sm border-black"
                    min="1"
                    type="number"
                    id="filterOrder"
                    value="20"
                    />
                </div>
            </div>
            <div class="flex w-full py-4 gap-4">

            <div class="flex items-center gap-2">
                <p class="font-medium ">Cutoff Frequency:</p>
                <input
                  class="border px-1 w-[152px] py-1 rounded-sm border-black"
                  type="number"
                  id="cutoffFrequency"
                  min="1"
                  value="10"
                />
              </div>
            <button
                class="bg-blue-500 text-white py-1 px-3 text-sm rounded-md hover:scale-105"
                onclick="generatePlots()"
            >
                Generate Plots
            </button>
            </div>
            <div class="plotSection">
              <canvas id="dsbscDemodulatedPlotCanvas" class="w-[600px] h-[0px]"></canvas>
              <canvas
                id="dsbscModulatedPlotCanvas"
                class="w-[600px] h-[0px]"
              ></canvas>
              <canvas
                id="messageSignalPlotCanvas"
                class="w-[600px] h-[0px]"
              ></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
        let myChart1, myChart2, myChart3; // Global variables to hold the chart instances

        function dsbsc_demodulation(messageFrequency, carrierFrequency, samplingFrequency, cutoffFrequency, filterOrder) {
            const fs = samplingFrequency;
            const numSamples = parseFloat(document.getElementById('samplingFrequency').value);
            const x_values = Array.from({length: numSamples}, (_, i) => i / fs);
            const message_signal = x_values.map(x => Math.sin(2 * Math.PI * messageFrequency * x));
            const carrier_signal = x_values.map(x => Math.cos(2 * Math.PI * carrierFrequency * x));
            const dsbsc_modulated_signal = message_signal.map((value, index) => value * carrier_signal[index]);
            const dsbsc_demodulated_signal = dsbsc_modulated_signal.map((value, index) => value * carrier_signal[index]);

            // Low-pass filter the demodulated signal
            const lpf_cutoff = cutoffFrequency;
            const lpfOrder = filterOrder;
            const nyquist = 0.5 * fs;
            const lpfCutoffNormalized = lpf_cutoff / nyquist;
            const b = butterworthCoefficients(lpfOrder, lpfCutoffNormalized, 'low');
            const a = [1]; // Denominator coefficients are 1 for an FIR filter
            const dsbsc_demodulated_signal_filtered = applyFilter(b, a, dsbsc_demodulated_signal);

            return {"x": x_values, "y": dsbsc_demodulated_signal_filtered, "modulated_signal": dsbsc_modulated_signal, "message_signal": message_signal};
        }

        // Function to compute Butterworth filter coefficients
        function butterworthCoefficients(order, cutoff, type) {
            const coefficients = [];
            const k = Math.tan(Math.PI * cutoff);
            const sqrt2 = Math.sqrt(2);

            if (type === 'low') {
                const denominator = 1 + sqrt2 * k + Math.pow(k, 2);
                for (let i = 0; i <= order; i++) {
                    const theta = (2 * i + 1) * Math.PI / (2 * order);
                    const sinTheta = Math.sin(theta);
                    const a = Math.pow(1 - sinTheta, 2);
                    const b = sqrt2 * Math.cos(theta);
                    const c = Math.pow(1 + sinTheta, 2);
                    coefficients.push((a + b + c) / denominator);
                }
            }

            return coefficients;
        }

        // Function to apply a filter to a signal
        function applyFilter(b, a, signal) {
            const filteredSignal = [];
            const len = signal.length;
            for (let n = 0; n < len; n++) {
                let y = 0;
                for (let i = 0; i < b.length; i++) {
                    if (n - i >= 0) {
                        y += b[i] * signal[n - i];
                    }
                }
                for (let i = 1; i < a.length; i++) {
                    if (n - i >= 0) {
                        y -= a[i] * filteredSignal[n - i];
                    }
                }
                filteredSignal.push(y);
            }
            return filteredSignal;
        }

        function plotDSBSCDemodulatedSignal(result) {
            const ctx = document.getElementById('dsbscDemodulatedPlotCanvas').getContext('2d');

            const plotData = {
                labels: result.x,
                datasets: [{
                    label: 'DSBSC Demodulated Signal',
                    data: result.y,
                    borderColor: 'blue',
                    borderWidth: 1,
                    fill: false
                }]
            };

            // Destroy existing chart if it exists
            if (myChart1) {
                myChart1.destroy();
            }

            myChart1 = new Chart(ctx, {
                type: 'line',
                data: plotData,
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amplitude'
                            }
                        }
                    }
                }
            });
        }

        function plotDSBSCModulatedSignal(result) {
            const ctx = document.getElementById('dsbscModulatedPlotCanvas').getContext('2d');

            const plotData = {
                labels: result.x,
                datasets: [{
                    label: 'DSBSC Modulated Signal',
                    data: result.modulated_signal,
                    borderColor: 'red',
                    borderWidth: 1,
                    fill: false
                }]
            };

            // Destroy existing chart if it exists
            if (myChart2) {
                myChart2.destroy();
            }

            myChart2 = new Chart(ctx, {
                type: 'line',
                data: plotData,
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amplitude'
                            }
                        }
                    }
                }
            });
        }

        function plotMessageSignal(result) {
            const ctx = document.getElementById('messageSignalPlotCanvas').getContext('2d');

            const plotData = {
                labels: result.x,
                datasets: [{
                    label: 'Message Signal',
                    data: result.message_signal,
                    borderColor: 'green',
                    borderWidth: 1,
                    fill: false
                }]
            };

            // Destroy existing chart if it exists
            if (myChart3) {
                myChart3.destroy();
            }

            myChart3 = new Chart(ctx, {
                type: 'line',
                data: plotData,
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amplitude'
                            }
                        }
                    }
                }
            });
        }

        function generatePlots() {
            const messageFrequency = parseFloat(document.getElementById('messageFrequency').value);
            const carrierFrequency = parseFloat(document.getElementById('carrierFrequency').value);
            const samplingFrequency = parseFloat(document.getElementById('samplingFrequency').value);
            const cutoffFrequency = parseFloat(document.getElementById('cutoffFrequency').value);
            const filterOrder = parseInt(document.getElementById('filterOrder').value);

            const result = dsbsc_demodulation(messageFrequency, carrierFrequency, samplingFrequency, cutoffFrequency, filterOrder);
            plotDSBSCDemodulatedSignal(result);
            plotDSBSCModulatedSignal(result);
            plotMessageSignal(result);
        }
    </script>
  </body>
</html>
